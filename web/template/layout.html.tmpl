{{ define "layout" }}
<!DOCTYPE html>
<html lang="en">

<head>
    <title>S3 Manager</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="stylesheet" href="{{$.RootURL}}/static/css/shadcn.css" />
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2'><path d='M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z'/></svg>">
</head>

<body>
    <div class="app-container">
        {{ template "content" . }}
    </div>

    <!-- S3 Instance Switcher -->
    {{ if and .S3Instances (gt (len .S3Instances) 1) }}
    <div class="instance-switcher">
        <button class="instance-btn" onclick="toggleS3Dropdown()" aria-label="Switch S3 Instance">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <ellipse cx="12" cy="5" rx="9" ry="3"/>
                <path d="M3 5V19A9 3 0 0 0 21 19V5"/>
                <path d="M3 12A9 3 0 0 0 21 12"/>
            </svg>
        </button>
        <div id="s3-instance-dropdown" class="instance-dropdown">
            {{ range .S3Instances }}
            <div class="instance-item {{ if eq .ID $.CurrentS3.ID }}active{{ end }}" 
                 onclick="switchS3Instance('{{ .ID }}', '{{ .Name }}')">
                <div class="instance-item-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <ellipse cx="12" cy="5" rx="9" ry="3"/>
                        <path d="M3 5V19A9 3 0 0 0 21 19V5"/>
                        <path d="M3 12A9 3 0 0 0 21 12"/>
                    </svg>
                </div>
                <span>{{ .Name }}</span>
            </div>
            {{ end }}
        </div>
    </div>
    {{ end }}

    <!-- Toast Container -->
    <div id="toast-container" class="toast-container"></div>

    <script src="{{$.RootURL}}/static/js/jquery-3.6.0.min.js"></script>
    <script>
        // Toast notification system
        function showToast(title, description, type = 'default') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.innerHTML = `
                <div class="toast-title">${title}</div>
                ${description ? `<div class="toast-description">${description}</div>` : ''}
            `;
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideInRight 0.2s ease reverse forwards';
                setTimeout(() => toast.remove(), 200);
            }, 3000);
        }

        // Dropdown management
        function toggleS3Dropdown() {
            const dropdown = document.getElementById('s3-instance-dropdown');
            dropdown.classList.toggle('active');
        }

        function switchS3Instance(instanceId, instanceName) {
            $.ajax({
                type: 'POST',
                url: '{{$.RootURL}}/api/s3-instances/' + instanceId + '/switch',
                success: function() {
                    showToast('Instance Switched', 'Now using: ' + instanceName);
                    setTimeout(function() {
                        window.location.href = '{{$.RootURL}}/buckets';
                    }, 1000);
                },
                error: function() {
                    showToast('Error', 'Failed to switch S3 instance');
                }
            });
            document.getElementById('s3-instance-dropdown').classList.remove('active');
        }

        // Close dropdowns when clicking outside
        document.addEventListener('click', function(event) {
            // S3 Instance Dropdown
            const switcher = document.querySelector('.instance-switcher');
            const dropdown = document.getElementById('s3-instance-dropdown');
            if (switcher && dropdown && !switcher.contains(event.target)) {
                dropdown.classList.remove('active');
            }
            
            // Close all action dropdowns
            document.querySelectorAll('.dropdown-menu').forEach(menu => {
                if (!menu.parentElement.contains(event.target)) {
                    menu.classList.remove('active');
                }
            });
        });

        // Modal management
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
            document.body.style.overflow = '';
        }

        // Close modal on overlay click
        document.addEventListener('click', function(event) {
            if (event.target.classList.contains('modal-overlay')) {
                event.target.classList.remove('active');
                document.body.style.overflow = '';
            }
        });

        // Close modal on escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                document.querySelectorAll('.modal-overlay.active').forEach(modal => {
                    modal.classList.remove('active');
                });
                document.body.style.overflow = '';
            }
        });
    </script>
</body>

</html>
{{ end }}
